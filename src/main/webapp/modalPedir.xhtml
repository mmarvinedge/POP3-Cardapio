<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <b:modal id="mdlPedir"  title="" styleClass="modalPseudoClass custom-modal fade-scale" size="modal-lg" headerClass="head-hidden" >
        <h:form id="frmModal" >



            <div class="modal-header" style="    background-image: url('#{facesContext.externalContext.request.contextPath}/resources/img/back.jpg');        height: 180px; min-height: 185px;    background-size: 100%; background-repeat: none;  max-height: 250px;padding: 16px 32px;">
                <button type="button" class="close" data-dismiss="modal" style=" background: white; border-radius: 32px;color: #337ab7;right:  15px;position: absolute;height: 35px;width: 35px;opacity: .7;font-size: 37px;">&times;</button>

                <div class="" style="    position: absolute;top: 55px;width: 94%;display: grid;background: rgba(255,255,255,0.7);padding: 10px;border-radius: 15px;left: 10px;height: 120px;padding-top: 0px;margin-top: 0px;line-height: normal;padding-bottom: 0px;">
                    <h3 class="" >#{orderMB.product.name}</h3>
                    <small >#{orderMB.product.description}</small>
                </div>
            </div>


            <div class="modal-body">
                <h:panelGroup id="grp" layout="block">
                    <p:blockUI block="grp" widgetVar="ldga"  >
                        <i class="fa fa-spinner fa-spin fa-2x fa-fw" style="color: #e83b62;"></i>
                    </p:blockUI>

                    <div class="row" style="padding: 10px;">
                        <div class="col-xs-12">
                            <h:panelGroup rendered="#{orderMB.item.product.categoryMain.name == 'Pizzas'}" >
                                <p:fieldset legend="Selecione até #{orderMB.item.product.maxPizza} sabor(es)" style="margin-top: 5px;">
                                    <h:panelGroup rendered="#{orderMB.item.product.promo}">
                                        <br/>
                                        <strong>PREÇO PROMOCIONAL <span style="font-size: 25px;color: #e83b62;"> #{orderMB.formatarMoeda(orderMB.item.product.price)}</span></strong>
                                    </h:panelGroup>
                                    <p:selectManyCheckbox value="#{orderMB.item.flavors}" converter="Converter"  layout="grid" columns="1" >
                                        <f:selectItems value="#{orderMB.item.product.flavorsPizza}" var="flav" 
                                                       itemLabel="#{flav.flavor} - #{orderMB.formatarMoeda(flav.price)}" itemValue="#{flav}"
                                                       itemDisabled="#{orderMB.item.flavors.size() == orderMB.item.product.maxPizza and orderMB.item.flavors.indexOf(flav) == -1}"
                                                       />
                                        <p:ajax event="change" listener="#{orderMB.processarTotalPizza()}" update=":frmModal:grpValue, @this" onstart="PF('ldga').show()" oncomplete="PF('ldga').hide()" />
                                    </p:selectManyCheckbox>
                                </p:fieldset>
                            </h:panelGroup>
                        </div>
                    </div>

                    <div class="row" style="padding: 10px;">
                        <div class="col-xs-12">
                            <ui:repeat value="#{orderMB.item.attributes}" var="at" varStatus="varie">
                                <p:fieldset legend="Selecione #{at.quantity} #{at.description}" style="margin-top: 5px;">
                                    <ui:repeat value="#{at.values}" var="it">
                                        <div class="row" style="border-bottom: 1px solid #ccc !important;margin-bottom: 5px;">
                                            <div class="col-xs-6">
                                                <small>
                                                    #{orderMB.formatarMoeda(it.price)} 
                                                </small><br/>
                                                <strong>
                                                    #{it.name}
                                                </strong>
                                            </div>
                                            <div class="col-xs-6 text-right">
                                                <h:panelGrid columns="3" style="float: right;" >

                                                    <p:commandLink id="btnMinus" action="#{orderMB.minQnt(it,at)}"  disabled="#{(at.travado and it.quantity == 0) or it.quantity == 0}" onstart="PF('ldga').show();" oncomplete="PF('ldga').hide();" >
                                                        <i class="fa fa-minus-circle fa-2x " style="color: #e83b62;"></i> 
                                                    </p:commandLink>
                                                    <p:inputNumber id="totQnt" value="#{it.quantity}"   style="width: 75px !important;" decimalPlaces="0" minValue="0" maxValue="#{at.quantity}" styleClass="iptNumber" readonly="true"  />
                                                    <p:commandLink id="btnPlus" action="#{orderMB.addQnt(it,at)}"  disabled="#{at.travado}" onstart="PF('ldga').show();" oncomplete="PF('ldga').hide();">
                                                        <i class="fa fa-plus-circle fa-2x " style="color: #e83b62;"></i> 
                                                    </p:commandLink>
                                                </h:panelGrid>
                                            </div>
                                        </div>
                                    </ui:repeat>
                                </p:fieldset>
                            </ui:repeat>
                        </div>
                    </div>


                    <div class="row" style="padding: 10px;">
                        <div class="col-xs-12">
                            <label>Recado</label>
                            <b:inputTextarea rows="2" value="#{orderMB.item.obs}" update="@this" />
                        </div>
                    </div>




                    <p:remoteCommand name="complete" action="#{orderMB.change()}" />
                    <div class="row">
                        <div class="col-md-3 text-left" style="padding-left: 25px;padding-right: 25px;">
                            <strong>Quantidade</strong>
                            <h5 style="position: absolute;right: 25px;top: -10px;font-size: 15px;font-weight: bolder;">#{orderMB.formatarMoeda(orderMB.product.price)}</h5>
                            <b:touchSpin id="spin1"   min="1" max="50" step="1" value="#{orderMB.item.quantity}" style="text-align: center;     " 
                                         style-class="ipt-touch"   onchange="PF('ldga').show();complete()"   oncomplete="PF('ldga').hide()"  >
                            </b:touchSpin>
                        </div>

                        <div class="col-md-5">

                        </div>

                        <div class="col-md-4" style="padding-left: 25px;padding-right: 25px; padding-bottom: 15px;">
                            <p:commandLink id="btnLinkAdd" styleClass="btn btn-primary btn-block text-right" action="#{orderMB.addCart()}" oncomplete="closeModal('mdlPedir');effect('ima-#{orderMB.product.id}')"  style="padding: 15px;     margin-top: 32px;"
                                           update=":grpNumbers,:frmMySide, pnlend">
                                <div class="row">
                                    <div class="col-xs-5 text-left bold">
                                        <h:panelGroup id="grpValue">
                                            <strong>
                                                #{orderMB.formatarMoeda((orderMB.item.total))}
                                            </strong>
                                        </h:panelGroup>

                                    </div>
                                    <div class="col-xs-7 text-right">
                                        <strong>Adicionar Item</strong>
                                    </div>
                                </div>
                            </p:commandLink>
                        </div>
                    </div>
                </h:panelGroup>
            </div>

        </h:form>
    </b:modal>

</html>

